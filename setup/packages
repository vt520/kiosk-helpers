#!/bin/bash
echo "Upgrading base packages"
( apt-get update -qq && apt-get -qqy upgrade ) > /dev/null || {
	echo "Base upgrades failed"
	exit 1
}
COUNT=0
TOTAL=$( wc -l < setup/packages.list )
echo
echo "Checking individual packages ($TOTAL) packages total"
while read PACKAGE ; do
	COUNT=$(( $COUNT + 1 ))
	[ -z "$PACKAGE" ] && continue;
	[ ( dpkg -l | grep $PACKAGE > /dev/null ) ] && {
		echo "Installed"
		continue
	}
	(
		( apt-get install -qqdy $PACKAGE ) \
		&& ( DEBIAN_FRONTEND=noninteractive \
 		apt-get install -qqy $PACKAGE )
	) || {
		echo $PACKAGE failed to install
		exit 1
	}
	[ $(( $COUNT % 50 )) -eq 0 ] && echo "$COUNT installed OK, $(( $TOTAL - $COUNT )) packages left"
done < setup/packages.list
